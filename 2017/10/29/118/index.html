<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://busuanzi.ibruce.info"><link rel="dns-prefetch" href="//cdn1.lncld.net"><link rel="dns-prefetch" href="//www.googletagmanager.com"><link rel="dns-prefetch" href="//www.google-analytics.com"><link rel="preload" href="https://cdn.jsdelivr.net/npm/busuanzi@2.3.0/bsz.pure.mini.js" as="script"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1,maximum-scale=5,viewport-fit=cover"><meta name="renderer" content="webkit"><title>Codeforces 671D Roads in Yusland | NekoMio&#39;s Blog</title><link rel="icon" type="image&#x2F;ico" href="/null.webp"><link rel="stylesheet" href="/lib/spectre/spectre.min.css"><style>body{background-color:#f8f9fa}a,a:visited{color:#0070ff}a:active,a:focus,a:hover{color:#0070ff;opacity:.75}#post-content a,#post-content a:focus,#post-content a:hover,#post-content a:visited{color:#005eb9;opacity:1}.post-entry .card-body a{color:#0070ff}.avatar{background:#444}.navbar-link,.navbar-link:visited,.timeline .timeline-item .timeline-icon.icon-lg{color:#0070ff}.navbar-link:hover{color:#0070ff;opacity:.8}#disqus-loadmore-button,#disqus-switch-to-direct,#disqus_click_btn,#search-input .btn{background:#727e96;border-color:#727e96;color:#fff}#post-toc a.post-toc-link,#post-toc a.post-toc-link:visited,.share-menu.menu .menu-item>a{color:#727e96}.share-menu.menu .menu-item>a:focus,.share-menu.menu .menu-item>a:hover,.share-menu.menu .menu-item>a:visited{color:#50596c;background:#f8f9fa;opacity:.85}</style><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/css/highlight/github.min.css" as="style" onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel="stylesheet" href="/css/highlight/github.min.css"></noscript><script>!function(n){"use strict";n.loadCSS||(n.loadCSS=function(){});var t,o=loadCSS.relpreload={};o.support=function(){var e;try{e=n.document.createElement("link").relList.supports("preload")}catch(t){e=!1}return function(){return e}}(),o.bindMediaToggle=function(t){var e=t.media||"all";function a(){t.addEventListener?t.removeEventListener("load",a):t.attachEvent&&t.detachEvent("onload",a),t.setAttribute("onload",null),t.media=e}t.addEventListener?t.addEventListener("load",a):t.attachEvent&&t.attachEvent("onload",a),setTimeout(function(){t.rel="stylesheet",t.media="only x"}),setTimeout(a,3e3)},o.poly=function(){if(!o.support())for(var t=n.document.getElementsByTagName("link"),e=0;e<t.length;e++){var a=t[e];"preload"!==a.rel||"style"!==a.getAttribute("as")||a.getAttribute("data-loadcss")||(a.setAttribute("data-loadcss",!0),o.bindMediaToggle(a))}},o.support()||(o.poly(),t=n.setInterval(o.poly,500),n.addEventListener?n.addEventListener("load",function(){o.poly(),n.clearInterval(t)}):n.attachEvent&&n.attachEvent("onload",function(){o.poly(),n.clearInterval(t)})),"undefined"!=typeof exports?exports.loadCSS=loadCSS:n.loadCSS=loadCSS}("undefined"!=typeof global?global:this)</script><link rel="alternate" type="application/rss+xml" href="/rss2.xml"><meta name="mobile-web-app-capable" content="yes"><meta name="application-name" content="NekoMio's Blog"><meta name="msapplication-starturl" content="https://www.nekomio.com"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="NekoMio's Blog"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta property="og:title" content="Codeforces 671D Roads in Yusland | NekoMio&#39;s Blog"><meta property="og:site_name" content="NekoMio&#39;s Blog"><meta property="og:type" content="article"><meta property="og:url" content="https://www.nekomio.com/2017/10/29/118/"><meta property="og:locale" content="zh-CN"><meta name="description" content="DescriptionMayor of Yusland just won the lottery and decided to spent money on something good for town. For example, repair all the roads in the town. Yusland consists of n intersections connected by  - NekoMio - NekoMio&#39;s Blog"><meta name="keywords" content="线性规划"><meta property="article:published_time" content="2017-10-29T12:36:20.000Z"><meta property="article:modified_time" content="2022-12-04T12:45:55.006Z"><meta property="og:updated_time" content="2022-12-04T12:45:55.006Z"><meta property="article:author" content="NekoMio"><meta property="article:tag" content="线性规划"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.nekomio.com/2017/10/29/118/"><meta name="generator" content="Hexo 5.4.2"><script async src="https://www.googletagmanager.com/gtag/js?id=G-T9TWLDVQ6L"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-T9TWLDVQ6L")</script><script type="application/ld+json">{
    "@context": "http://schema.org",
    "url": "https://www.nekomio.com/2017/10/29/118/",
    "@type": "BlogPosting",
    "logo": "https://www.nekomio.com/null.webp",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://www.nekomio.com/2017/10/29/118/"
    },
    "headline": "Codeforces 671D Roads in Yusland | NekoMio&#39;s Blog",
    
    "image": {
        "@type": "ImageObject",
        "url": "https://www.nekomio.com/null.webp"
    },
    
    "datePublished": "2017-10-29T12:36:20.000Z",
    "dateModified": "2022-12-04T12:45:55.006Z",
    "author": {
        "@type": "Person",
        "name": "NekoMio",
        "image": {
            "@type": "ImageObject",
            "url": "https://www.nekomio.com/null.webp"
        },
        "description": "美しいものが起こることを常に信じている"
    },
    "publisher": {
        "@type": "Organization",
        "name": "NekoMio&#39;s Blog",
        "logo": {
            "@type": "ImageObject",
            "url": "https://www.nekomio.com/null.webp"
        }
    },
    
    "potentialAction": {
        "@type": "SearchAction",
        "target": "https://www.nekomio.com/search.html?s={search_term_string}",
        "query-input": "required name=search_term_string"
    },
    
    "keywords": "线性规划",
    "description": "DescriptionMayor of Yusland just won the lottery and decided to spent money on something good for town. For example, repair all the roads in the town. Yusland consists of n intersections connected by  - NekoMio - NekoMio&#39;s Blog"
}</script><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/KaTeX/0.16.0/katex.min.css" integrity="sha384-Xi8rHCmBmhbuyyhbI88391ZKP2dmfnOl4rT9ZfRI7mLTdk1wblIUnrIq35nqwEvC" crossorigin="anonymous"><script>window.WebFontConfig={custom:{families:["KaTeX_AMS","KaTeX_Caligraphic:n4,n7","KaTeX_Fraktur:n4,n7","KaTeX_Main:n4,n7,i4,i7","KaTeX_Math:i4,i7","KaTeX_Script","KaTeX_SansSerif:n4,n7,i4","KaTeX_Size1","KaTeX_Size2","KaTeX_Size3","KaTeX_Size4","KaTeX_Typewriter"]}}</script><script defer src="https://cdn.bootcdn.net/ajax/libs/webfont/1.6.28/webfontloader.js"></script><style>::-webkit-scrollbar{width:5px;height:8px;background-color:#b9b9b9}::-webkit-scrollbar-track{border-radius:10px;background-color:#b9b9b9}::-webkit-scrollbar-thumb{border-radius:10px;background-color:#ffb6b9}</style><style>html:not([stylus-iframe]) body:before{content:"";position:fixed;top:0;right:0;bottom:0;left:0;z-index:-100;background-image:url(https://file.nekomio.com/img/bg.webp);background-position:center bottom;background-size:cover;background-attachment:fixed;background-repeat:no-repeat}@media screen and (max-width:1650px){html:not([stylus-iframe]) body:before{background-image:url(https://file.nekomio.com/img/bg_small.webp)}}</style></head><body><header><h1 class="header-title text-center"><a href="/">NekoMio&#39;s Blog</a></h1><p class="text-center header-slogan">美しいものが起こることを常に信じている</p><nav class="navbar-section text-center"><a href="/" class="navbar-link">首页</a> <a href="/archives/" class="navbar-link">归档</a> <a href="/search.html" class="navbar-link">搜索</a> <a href="/links.html" class="navbar-link">Friends</a><div class="dropdown dropdown-right"><a class="navbar-link dropdown-toggle" tabindex="0">分享</a><ul class="menu share-menu"><li class="menu-item"><a href="http://service.weibo.com/share/share.php?appkey=&title=NekoMio's Blog&url=https://www.nekomio.com&pic=https://www.nekomio.com/null.webp&searchPic=false&style=simple" target="_blank" rel="external noopener noreferrer nofollow">分享到微博</a></li><li class="menu-item"><a href="https://twitter.com/intent/tweet?text=NekoMio's Blog&url=https://www.nekomio.com&via=NekoMio" target="_blank" rel="external noopener noreferrer nofollow">分享到 Twitter</a></li><li class="menu-item"><a href="https://www.facebook.com/sharer/sharer.php?u=https://www.nekomio.com" target="_blank" rel="external noopener noreferrer nofollow">分享到 Facebook</a></li><li class="menu-item"><a href="https://plus.google.com/share?url=https://www.nekomio.com" target="_blank" rel="external noopener noreferrer nofollow">分享到 Google+</a></li><li class="menu-item"><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://www.nekomio.com&title=Codeforces 671D Roads in Yusland" target="_blank" rel="external noopener noreferrer nofollow">分享到 LinkedIn</a></li><li class="menu-item"><a href="http://connect.qq.com/widget/shareqq/index.html?site=NekoMio's Blog&title=Codeforces 671D Roads in Yusland&summary=NekoMio 的博客 爱这个世界&pics=https://www.nekomio.com/null.webp&url=https://www.nekomio.com" target="_blank" rel="external noopener noreferrer nofollow">分享到 QQ</a></li><li class="menu-item"><a href="https://t.me/share/url?url=https://www.nekomio.com&text=Codeforces 671D Roads in Yusland" target="_blank" rel="external noopener noreferrer nofollow">分享到 Telegram</a></li><li class="menu-item"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIQAAACECAAAAAB0L9x7AAABgUlEQVR42u3aQQ7CMAxE0d7/0rBGij3jUtoJ+t0gqja8RXBsJ8cr4DpAgACxBeJoro8Xmu+r95xxQeQilpNm8aPuPXdcENmI1cRy7lco9T6I/RHV5CsDEYi/RqwCjrOAgdgbUS00HUpNyMtWURC3I7qE9JvPy7JtELciZNHaBJvVRP1JVQ7iVoSToFRJrFMYVeOByEV0i1E3qPOMaraAyER0BYsTwNxGmxWsQMQgZFBpklwHVgY5EJEI1TyVAw2CmLWAgYhAqKbXtNi1E2MQkYiqeOkGdJsjakEEkYloHxILmkqUKyiIbMR00TmT7I7+HSBiENMANIWd2vkB8TiiapJ1G7Cqsd4GOBDRCDd4OZu3aqKD2AOhDm+caaJWExxENsLZiJs0WyebLyAyEdbG+qCp5hTPIPIRkybYmU3aUeMMRAxiMtm6IKSKn1FBDCIe4QYvdUAExP4I1Sx1Dv0tkSCiEU7C6hwCUgkOiD0QTiE7LmympxBBxCCevECAABGNeAMsYjkIwBhdlAAAAABJRU5ErkJggg==" alr="QRCode"></li></ul></div></nav></header><div class="post-container"><div id="post-card" class="card"><div class="card-item-container"><div class="card-inner-cell"><div class="card-header"><h1 class="card-title h3 mb-2">Codeforces 671D Roads in Yusland</h1><div class="post-header-info"><p class="post-header-info-left text-gray"><img class="author-thumb lazyload" data-src="/null.webp" src="/img/suka-lazyload.gif" alt="NekoMio's Avatar"> <span>2017-10-29</span> <span class="suka-devide-dot"></span> <a class="category-link" href="/categories/%E9%A2%98%E8%A7%A3/">题解</a><span id="busuanzi_container_page_pv" hidden><span class="suka-devide-dot"></span> <span></span> <span id="busuanzi_value_page_pv"></span> <span>Views</span></span></p><div class="post-header-info-right"><div class="dropdown dropdown-right"><a class="dropdown-toggle" tabindex="0">分享本文</a><ul class="menu share-menu"><li class="menu-item"><a href="http://service.weibo.com/share/share.php?appkey=&title=Codeforces 671D Roads in Yusland&url=https://www.nekomio.com/2017/10/29/118/&pic=https://www.nekomio.com/null.webp&searchPic=false&style=simple" target="_blank" rel="external noopener noreferrer nofollow">分享到微博</a></li><li class="menu-item"><a href="https://twitter.com/intent/tweet?text=Codeforces 671D Roads in Yusland&url=https://www.nekomio.com/2017/10/29/118/&via=NekoMio" target="_blank" rel="external noopener noreferrer nofollow">分享到 Twitter</a></li><li class="menu-item"><a href="https://www.facebook.com/sharer/sharer.php?u=https://www.nekomio.com/2017/10/29/118/" target="_blank" rel="external noopener noreferrer nofollow">分享到 Facebook</a></li><li class="menu-item"><a href="https://plus.google.com/share?url=https://www.nekomio.com/2017/10/29/118/" target="_blank" rel="external noopener noreferrer nofollow">分享到 Google+</a></li><li class="menu-item"><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://www.nekomio.com/2017/10/29/118/&title=NekoMio's Blog" target="_blank" rel="external noopener noreferrer nofollow">分享到 LinkedIn</a></li><li class="menu-item"><a href="http://connect.qq.com/widget/shareqq/index.html?site=NekoMio's Blog&title=NekoMio's Blog&summary=NekoMio 的博客 爱这个世界&pics=https://www.nekomio.com/null.webp&url=https://www.nekomio.com/2017/10/29/118/" target="_blank" rel="external noopener noreferrer nofollow">分享到 QQ</a></li><li class="menu-item"><a href="https://t.me/share/url?url=https://www.nekomio.com/2017/10/29/118/&text=NekoMio's Blog" target="_blank" rel="external noopener noreferrer nofollow">分享到 Telegram</a></li><li class="menu-item"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIQAAACECAAAAAB0L9x7AAABgUlEQVR42u3aQQ7CMAxE0d7/0rBGij3jUtoJ+t0gqja8RXBsJ8cr4DpAgACxBeJoro8Xmu+r95xxQeQilpNm8aPuPXdcENmI1cRy7lco9T6I/RHV5CsDEYi/RqwCjrOAgdgbUS00HUpNyMtWURC3I7qE9JvPy7JtELciZNHaBJvVRP1JVQ7iVoSToFRJrFMYVeOByEV0i1E3qPOMaraAyER0BYsTwNxGmxWsQMQgZFBpklwHVgY5EJEI1TyVAw2CmLWAgYhAqKbXtNi1E2MQkYiqeOkGdJsjakEEkYloHxILmkqUKyiIbMR00TmT7I7+HSBiENMANIWd2vkB8TiiapJ1G7Cqsd4GOBDRCDd4OZu3aqKD2AOhDm+caaJWExxENsLZiJs0WyebLyAyEdbG+qCp5hTPIPIRkybYmU3aUeMMRAxiMtm6IKSKn1FBDCIe4QYvdUAExP4I1Sx1Dv0tkSCiEU7C6hwCUgkOiD0QTiE7LmympxBBxCCevECAABGNeAMsYjkIwBhdlAAAAABJRU5ErkJggg==" alt="QRCode"></li></ul></div></div></div></div><div class="card-body"><article id="post-content"><h3 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h3><p>Mayor of Yusland just won the lottery and decided to spent money on something good for town. For example, repair all the roads in the town.</p><p>Yusland consists of n intersections connected by n - 1 bidirectional roads. One can travel from any intersection to any other intersection using only these roads.</p><p>There is only one road repairing company in town, named “RC company”. Company’s center is located at the intersection 1. RC company doesn’t repair roads you tell them. Instead, they have workers at some intersections, who can repair only some specific paths. The i-th worker can be paid ci coins and then he repairs all roads on a path from ui to some vi that lies on the path from ui to intersection 1.</p><p>Mayor asks you to choose the cheapest way to hire some subset of workers in order to repair all the roads in Yusland. It’s allowed that some roads will be repaired more than once.</p><p>If it’s impossible to repair all roads print  -1.</p><h3 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h3><p>The first line of the input contains two integers n and m (1 ≤ n, m ≤ 300 000) — the number of cities in Yusland and the number of workers respectively.</p><p>Then follow n−1 line, each of them contains two integers xi and yi (1 ≤ xi, yi ≤ n) — indices of intersections connected by the i-th road.</p><p>Last m lines provide the description of workers, each line containing three integers ui, vi and ci (1 ≤ ui, vi ≤ n, 1 ≤ ci ≤ 109). This means that the i-th worker can repair all roads on the path from vi to ui for ci coins. It’s guaranteed that vi lies on the path from ui to 1. Note that vi and ui may coincide.</p><h3 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h3><p>If it’s impossible to repair all roads then print  -1. Otherwise print a single integer — minimum cost required to repair all roads using “RC company” workers.</p><h3 id="input"><a href="#input" class="headerlink" title="input"></a>input</h3><pre><code>6 5
1 2
1 3
3 4
4 5
4 6
2 1 2
3 1 4
4 1 3
5 3 1
6 3 2
</code></pre><h3 id="output"><a href="#output" class="headerlink" title="output"></a>output</h3><pre><code>8
</code></pre><h2 id="题意"><a href="#题意" class="headerlink" title="题意"></a>题意</h2><blockquote><p>给一颗树，给定m对祖先节点关系。 每选用一对关系需要付出c的花费， 求用这些关系将所有边都覆盖的最小花费。</p></blockquote><p>本题有 $nlog(n)$ 树DP做法请看<a target="_blank" rel="noopener" href="http://cooook.coding.me/2017/10/29/CF671D/">CF671D 树形DP+数据结构优化DP</a></p><p>这里我想说一下 $nlog(n)$ 的贪心做法</p><p>我们将修路转化为修点， 1 号点不用修<br>首先我们设$x_i$为第$i$个工人的使用次数。 那么显然$x_i \geq 0$<br>然设一个$A$矩阵如果第$j$个工人能覆盖到第$i$点那么$A_{i,j}=1$否则$A_{i,j}=0$<br>那么很显然对于$(\forall 2 &lt;= i &lt;= n)$都有$\sum_{j = 1}^{m}{A_{i,j}*x_j} &gt; 0$</p><p>如果将这个过程看作矩阵乘， 将x看作m行1列的矩阵<br>那么<br>$$\begin{bmatrix} A_{1,1} &amp; A_{1,2} &amp; A_{1,3} &amp; \cdots &amp; A_{1,m} \\ A_{2,1} &amp; A_{2,2} &amp; A_{2,3} &amp; \cdots &amp; A_{2,m} \\ \vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\ A_{n,1} &amp; A_{n,2} &amp; A_{n,3} &amp; \cdots &amp; A_{n,m} \\ \end{bmatrix}<br>\begin{bmatrix} x_{1,1} \\ x_{1,2} \\ x_{1,3} \\ \vdots \\ x_{1,m} \\ \end{bmatrix} \geq \begin{bmatrix} 1 \\ 1 \\ 1 \\ \vdots \\ 1 \\ \end{bmatrix}$$</p><p>我们设右边的矩阵为$e$</p><p>那么我们要求的答案为<br>$$ min\{\sum_{j=1}^{m}c_j * x_j\} $$</p><p>如果将c看作矩阵则答案为<br>$min\{c^Tx\}$</p><p>那么我们发现他是一个线性规划问题。<br>我们可以考虑它的对偶问题。<br>由于对偶问题求得到函数值与原问题相等， 那么我们只需要求出对偶问题的答案。</p><p>下面说一下对偶问题的构造</p><blockquote><ol><li>给每个原始约束条件定义一个非负对偶变量$y_i (i=1,2,…,m)$;</li><li>使原问题的目标函数系数cj变为其对偶问题约束条件的右端常数</li><li>使原问题约束条件的右端常数bi变为其对偶问题目标函数的系数；</li><li>将原问题约束条件的系数矩阵转置，得到其对偶问题约束条件的系数矩阵；</li><li>改变约束条件不等号的方向，即将”=&lt;”改为”&gt;=”；</li><li>原问题“max”型，对偶问题为“min”型．反之亦然.</li></ol></blockquote><p>那么本题的对偶问题为</p><p>$y &gt;= 0$<br>$A^Ty &lt;= c$</p><p>求$ max\{e^Ty\} $<br>$e$ 是上文中设的矩阵</p><p>那么用人话说就是</p><p>每个点可以选多次一个工人的路径上的点的选择次数的和在$c_i$以内， 求所有点选择次数的最大和。</p><p>我们可以贪心的由下向上选取。<br>用一个set启发式合并就可以了。</p><p>时间复杂度$nlog(n)$ 常数略大。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// #pragma GCC optimize(&quot;O3&quot;)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">300005</span>;</span><br><span class="line"><span class="type">char</span> xch,xB[<span class="number">1</span>&lt;&lt;<span class="number">15</span>],*xS=xB,*xTT=xB;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> getc() (xS==xTT&amp;&amp;(xTT=(xS=xB)+fread(xB,1,1&lt;&lt;15,stdin),xS==xTT)?0:*xS++)</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">read</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> x=<span class="number">0</span>,f=<span class="number">1</span>;<span class="type">char</span> ch=<span class="built_in">getc</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>)&#123;<span class="keyword">if</span>(ch==<span class="string">&#x27;-&#x27;</span>)f=<span class="number">-1</span>;ch=<span class="built_in">getc</span>();&#125;</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>)&#123;x=x*<span class="number">10</span>+ch-<span class="string">&#x27;0&#x27;</span>;ch=<span class="built_in">getc</span>();&#125;</span><br><span class="line">    <span class="keyword">return</span> x*f;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">edge</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> END, next;</span><br><span class="line">&#125;v[MAXN &lt;&lt; <span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> first[MAXN], p;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    v[p].END = b;</span><br><span class="line">    v[p].next = first[a];</span><br><span class="line">    first[a] = p++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">data</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> v, cnt;</span><br><span class="line">    <span class="built_in">data</span>(<span class="type">int</span> c = <span class="number">0</span>, <span class="type">int</span> cn = <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        v = c, cnt = cn;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> &lt; (<span class="type">const</span> data &amp;a) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> cnt == a.cnt ? v &lt; a.v : cnt &lt; a.cnt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">vector&lt;data&gt; Add[MAXN], rm[MAXN];</span><br><span class="line">set&lt;data&gt; st[MAXN];</span><br><span class="line"><span class="type">long</span> <span class="type">long</span> ans;</span><br><span class="line"><span class="type">int</span> C[MAXN], Ad[MAXN];</span><br><span class="line"><span class="type">bool</span> died;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> rt, <span class="type">int</span> fa)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    set&lt;data&gt;::iterator it;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; Add[rt].<span class="built_in">size</span>(); i++)</span><br><span class="line">        st[rt].<span class="built_in">insert</span>(Add[rt][i]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = first[rt]; i != <span class="number">-1</span>; i = v[i].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (v[i].END == fa) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs</span>(v[i].END, rt);</span><br><span class="line">        <span class="keyword">if</span> (died) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span> (st[v[i].END].<span class="built_in">size</span>() &gt; st[rt].<span class="built_in">size</span>())</span><br><span class="line">            <span class="built_in">swap</span>(st[v[i].END], st[rt]), <span class="built_in">swap</span>(Ad[v[i].END], Ad[rt]);</span><br><span class="line">        <span class="keyword">for</span> (it = st[v[i].END].<span class="built_in">begin</span>(); it != st[v[i].END].<span class="built_in">end</span>(); it++)</span><br><span class="line">            st[rt].<span class="built_in">insert</span>(<span class="built_in">data</span>(it-&gt;v, C[it-&gt;v] = it-&gt;cnt - Ad[v[i].END] + Ad[rt]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; rm[rt].<span class="built_in">size</span>(); i++)</span><br><span class="line">        st[rt].<span class="built_in">erase</span>(<span class="built_in">data</span>(rm[rt][i].v, C[rm[rt][i].v]));</span><br><span class="line">    <span class="keyword">if</span> (rt == <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (st[rt].<span class="built_in">empty</span>()) &#123;died = <span class="number">1</span>; <span class="keyword">return</span>;&#125;</span><br><span class="line">    ans += st[rt].<span class="built_in">begin</span>()-&gt;cnt - Ad[rt];</span><br><span class="line">    Ad[rt] += st[rt].<span class="built_in">begin</span>()-&gt;cnt - Ad[rt];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n = <span class="built_in">read</span>(), m = <span class="built_in">read</span>(), a, b, c;</span><br><span class="line">    <span class="built_in">memset</span> (first, <span class="number">-1</span>, <span class="built_in">sizeof</span> (first));</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        a = <span class="built_in">read</span>(), b = <span class="built_in">read</span>();</span><br><span class="line">        <span class="built_in">add</span>(a, b);</span><br><span class="line">        <span class="built_in">add</span>(b, a);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        a = <span class="built_in">read</span>(), b = <span class="built_in">read</span>(), c = <span class="built_in">read</span>();</span><br><span class="line">        Add[a].<span class="built_in">push_back</span>(<span class="built_in">data</span>(i, c));</span><br><span class="line">        rm[b].<span class="built_in">push_back</span>(<span class="built_in">data</span>(i, c));</span><br><span class="line">        C[i] = c;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dfs</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (died) <span class="built_in">printf</span> (<span class="string">&quot;-1&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">printf</span> (<span class="string">&quot;%lld&quot;</span>, ans);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></article><blockquote class="post-license"><p><strong>本文作者&nbsp;:&nbsp;NekoMio</strong><br><strong><a rel="license noopener" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。</strong><br><strong>本文链接&nbsp;:&nbsp;</strong><a href="https://www.nekomio.com/2017/10/29/118/">https://www.nekomio.com/2017/10/29/118/</a></p></blockquote><blockquote id="date-expire-notification" class="post-expired-notify">本文最后更新于 <span id="date-expire-num"></span> 天前，文中所描述的信息可能已发生改变</blockquote><script>!function(){var e=Date.parse("2022-12-04"),t=(new Date).getTime(),t=Math.floor((t-e)/864e5);120<=t?document.getElementById("date-expire-num").innerHTML=t:document.getElementById("date-expire-notification").style.display="none"}()</script><p class="post-footer-info mb-0 pt-0">本文发表于&nbsp;<time datetime="2017-10-29T12:36:20.000Z" itemprop="datePublished">2017-10-29</time> , 最后修改于&nbsp;<time datetime="2022-12-04T12:45:55.006Z" itemprop="dateModified">2022-12-04</time></p><p class="post-footer-info mb-0 pt-2"><span class="post-categories-list mt-2"><a class="post-categories-list-item" href="/categories/%E9%A2%98%E8%A7%A3/">题解</a> </span><span class="post-tags-list mt-2"><a class="post-tags-list-item" href="/tags/%E7%BA%BF%E6%80%A7%E8%A7%84%E5%88%92/" rel="tag">#&nbsp;线性规划</a></span></p></div><div class="post-nav px-2 bg-gray"><ul class="pagination"><li class="page-item page-prev"><a href="/2017/10/30/119/" rel="prev"><div class="page-item-title"><i class="icon icon-back" aria-hidden="true"></i></div><div class="page-item-subtitle">BZOJ3925 状压DP+概率DP</div></a></li><li class="page-item page-next"><a href="/2017/10/28/117/" rel="next"><div class="page-item-title"><i class="icon icon-forward" aria-hidden="true"></i></div><div class="page-item-subtitle">BZOJ 3167 [Heoi2013] Sao</div></a></li></ul></div><div class="card-footer post-comment"><div id="vcomments"></div><script src="https://cdn.bootcdn.net/ajax/libs/valine/1.5.1/Valine.min.js"></script><script>var GUEST_INFO=["nick","mail","link"],guest_info="nick,mail,link".split(",").filter(function(e){return-1<GUEST_INFO.indexOf(e)}),notify=!1,verify=!1;new Valine({el:"#vcomments",notify:notify,verify:verify,appId:"hRRi8jRRJiMaKCoOeToz8Geo-gzGzoHsz",appKey:"1gTOBrBAIYbj2urmHJfu5gcl",placeholder:"评论经过人工审核后可见(Comment are visible after manual review)",meta:guest_info,pageSize:"10",avatar:"identicon",lang:"zh-cn",serverURLs:"https://leancloud.nekomio.com",guest_info:guest_info,visitor:!1})</script></div></div></div></div></div><footer class="text-center"><p class="footer-copyright mb-0">Copyright&nbsp;©&nbsp;<span id="copyright-year"></span> <a class="footer-copyright-a" href="https://www.nekomio.com">NekoMio's Blog</a></p><p class="footer-text mb-0"><a target="_blank" href="https://beian.miit.gov.cn/" rel="nofollow noopener noreferrer noopener">京ICP备19044785号-1</a><br>「<a target="_blank" rel="noopener" href="https://webify.cloudbase.net/">CloudBase Webify</a> 与 <a target="_blank" rel="noopener" href="https://www.cloudflare.com/">Cloudflare Pages</a> 提供网站托管服务」</p><p class="footer-develop mb-0"><span id="busuanzi_container_site_uv" hidden><span></span> <span id="busuanzi_value_site_uv"></span> <span>Viewers</span> <span>|</span> </span>Powered by&nbsp;<a href="https://hexo.io" target="_blank" class="footer-develop-a" rel="external nofollow noopener noreferrer">Hexo</a><span class="footer-develop-divider"></span>Theme&nbsp;-&nbsp;<a href="https://github.com/SukkaW/hexo-theme-suka" target="_blank" class="footer-develop-a" rel="external noopener">Suka</a></p></footer><script>window.lazyLoadOptions={elements_selector:".lazyload",threshold:50},function(){var e=(new Date).getFullYear(),o=document.getElementById("copyright-year");o.textContent=2017===e?e:"2017 - "+e}(),console.log("\n %c Suka Theme (hexo-theme-suka) | © SukkaW | Verision 1.4.0 %c https://github.com/SukkaW/hexo-theme-suka \n","color: #fff; background: #444; padding:5px 0;","background: #bbb; padding:5px 0;")</script><script src="/lib/vanilla-lazyload/lazyload.min.js" async></script><script src="https://cdn.jsdelivr.net/npm/busuanzi@2.3.0/bsz.pure.mini.js" async></script><script defer src="https://cdn.bootcdn.net/ajax/libs/KaTeX/0.16.0/katex.min.js" integrity="sha384-X/XCfMm41VSsqRNQgDerQczD69XqmjOOOwYQvr/uuC+j4OPoNhVgjdGFwhvN02Ja" crossorigin="anonymous"></script><script defer src="https://cdn.bootcdn.net/ajax/libs/KaTeX/0.16.0/contrib/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],throwOnError:!1})})</script></body></html>