/*!
 * Copyright 2012, Chris Wanstrath
 * Released under the MIT License
 * https://github.com/defunkt/jquery-pjax
 */
!function(t){function e(e,r,a){return a=j(r,a),this.on("click.pjax",e,(function(e){var r=a;r.container||((r=t.extend({},a)).container=t(this).attr("data-pjax")),n(e,r)}))}function n(e,n,r){r=j(n,r);var a=e.currentTarget,i=t(a);if("A"!==a.tagName.toUpperCase())throw"$.fn.pjax or $.pjax.click requires an anchor element";if(!(e.which>1||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||location.protocol!==a.protocol||location.hostname!==a.hostname||a.href.indexOf("#")>-1&&g(a)==g(location)||e.isDefaultPrevented())){var s={url:a.href,container:i.attr("data-pjax"),target:a},c=t.extend({},s,r),u=t.Event("pjax:click");i.trigger(u,[c,i]),u.isDefaultPrevented()||(o(c,i),e.preventDefault(),i.trigger("pjax:clicked",[c]))}}function r(e,n,r){r=j(n,r);var a=e.currentTarget,i=t(a);if("FORM"!==a.tagName.toUpperCase())throw"$.pjax.submit requires a form element";var s={type:(i.attr("method")||"GET").toUpperCase(),url:i.attr("action"),container:i.attr("data-pjax"),target:a};if("GET"!==s.type&&void 0!==window.FormData)s.data=new FormData(a),s.processData=!1,s.contentType=!1;else{if(i.find(":file").length)return;s.data=i.serializeArray()}o(t.extend({},s,r),i),e.preventDefault()}function a(e,n){var r=t(e);if("FORM"!==e.tagName.toUpperCase())throw"$.pjax.submit requires a form element";var a={type:(r.attr("method")||"GET").toUpperCase(),url:r.attr("action"),container:r.attr("data-pjax"),target:e};if("GET"!==a.type&&void 0!==window.FormData)a.data=new FormData(e),a.processData=!1,a.contentType=!1;else{if(r.find(":file").length)return;a.data=r.serializeArray()}o(t.extend({},a,n),r)}function o(e,n){e=t.extend(!0,{},t.ajaxSettings,o.defaults,e),t.isFunction(e.url)&&(e.url=e.url());var r,a=y(e.url).hash,s=(t.type(e.container),new Array),u=new Array;for(i in e.context=new Array,e.container){let n=t(e.container[i]);e.context.push(n),s.push(n),u.push(n.clone())}if(!s.length)throw"the container selector '"+e.container+"' did not match anything";function l(n,r,a){a||(a={}),a.relatedTarget=e.target;var i=t.Event(n,a);return s[0].trigger(i,r),!i.isDefaultPrevented()}void 0!==n&&n.trigger("pjax:afterGetContainers",[e,n]),e.data||(e.data={}),t.isArray(e.data),e.beforeSend=function(t,n){if("GET"!==n.type&&(n.timeout=0),t.setRequestHeader("X-PJAX","true"),t.setRequestHeader("X-PJAX-Container",e.container),!l("pjax:beforeSend",[t,n]))return!1;n.timeout>0&&(r=setTimeout((function(){l("pjax:timeout",[t,e])&&t.abort("timeout")}),n.timeout),n.timeout=0);var i=y(n.url);a&&(i.hash=a),e.requestUrl=x(i)},e.complete=function(t,n){r&&clearTimeout(r),l("pjax:complete",[t,n,e]),l("pjax:end",[t,e])},e.error=function(t,n,r){var a=T("",t,e),i=l("pjax:error",[t,n,r,e]);"GET"==e.type&&"abort"!==n&&i&&c(a.url)},e.success=function(n,r,u){var p=o.state,f="function"==typeof t.pjax.defaults.version?t.pjax.defaults.version():t.pjax.defaults.version,d=u.getResponseHeader("X-PJAX-Version"),h=T(n,u,e),v=y(h.url);if(a&&(v.hash=a,h.url=v.href),f&&d&&f!==d)c(h.url);else if(h.contents&&null!=h.contents[0]){if(o.state={id:e.id||m(),url:h.url,title:h.title,container:e.container,fragment:e.fragment,timeout:e.timeout},(e.push||e.replace)&&window.history.replaceState(o.state,h.title,h.url),t.contains(s[0],document.activeElement))try{document.activeElement.blur()}catch(t){}for(i in h.title&&(document.title=h.title),l("pjax:beforeReplace",[h.contents,e],{state:o.state,previousState:p}),s)s[i].html(h.contents[i]);var x=s[0].find("input[autofocus], textarea[autofocus]").last()[0];x&&document.activeElement!==x&&x.focus(),function(e){if(!e)return;var n=t("script[src]");e.each((function(){var e=this.src;if(!n.filter((function(){return this.src===e})).length){var r=document.createElement("script"),a=t(this).attr("type");a&&(r.type=a),r.src=t(this).attr("src"),document.head.appendChild(r)}}))}(h.scripts);var g=e.scrollTo;if(a){var j=decodeURIComponent(a.slice(1)),w=document.getElementById(j)||document.getElementsByName(j)[0];w&&(g=t(w).offset().top)}"number"==typeof g&&t("html, body").animate({scrollTop:g},600),l("pjax:success",[n,r,u,e])}else c(h.url)},o.state||(o.state={id:m(),url:window.location.href,title:document.title,container:e.container,fragment:e.fragment,timeout:e.timeout},window.history.replaceState(o.state,document.title)),h(o.xhr),o.options=e;var p,f,d=o.xhr=t.ajax(e);return d.readyState>0&&(e.push&&!e.replace&&(p=o.state.id,f=[e.container,v(u)],E[p]=f,S.push(p),C(A,0),C(S,o.defaults.maxCacheLength),window.history.pushState(null,"",e.requestUrl)),l("pjax:start",[d,e]),l("pjax:send",[d,e])),o.xhr}function s(e,n){var r={url:window.location.href,push:!1,replace:!0,scrollTo:!1};return o(t.extend(r,j(e,n)))}function c(t){window.history.replaceState(null,"",o.state.url),window.location.replace(t)}var u=!0,l=window.location.href,p=window.history.state;function f(e){u||h(o.xhr);var n,r=o.state,a=e.state;if(a&&a.container){if(u&&l==a.url)return;if(r){if(r.id===a.id)return;n=r.id<a.id?"forward":"back"}var s=E[a.id]||[],p=s[0]||a.container,f=Array(),d=s[1];for(i in p)f.push(t(p[i]));if(f.length&&f[0].length){r&&function(t,e,n){var r,a;E[e]=n,"forward"===t?(r=S,a=A):(r=A,a=S);r.push(e),(e=a.pop())&&delete E[e];C(r,o.defaults.maxCacheLength)}(n,r.id,[p,v(f)]);var m=t.Event("pjax:popstate",{state:a,direction:n});for(i in f)f[i].trigger(m);var x={id:a.id,url:a.url,container:p,push:!1,fragment:a.fragment,timeout:a.timeout,scrollTo:!1};if(d)for(i in f){f[i].trigger("pjax:start",[null,x]),o.state=a,a.title&&(document.title=a.title);var y=t.Event("pjax:beforeReplace",{state:a,previousState:r});f[i].trigger(y,[d,x]),f[i].html(d[i]),f[i].trigger("pjax:end",[null,x])}else o(x);f[0].offsetHeight}else c(location.href)}u=!1}function d(e){var n=t.isFunction(e.url)?e.url():e.url,r=e.type?e.type.toUpperCase():"GET",a=t("<form>",{method:"GET"===r?"GET":"POST",action:n,style:"display:none"});"GET"!==r&&"POST"!==r&&a.append(t("<input>",{type:"hidden",name:"_method",value:r.toLowerCase()}));var i=e.data;if("string"==typeof i)t.each(i.split("&"),(function(e,n){var r=n.split("=");a.append(t("<input>",{type:"hidden",name:r[0],value:r[1]}))}));else if(t.isArray(i))t.each(i,(function(e,n){a.append(t("<input>",{type:"hidden",name:n.name,value:n.value}))}));else if("object"==typeof i){var o;for(o in i)a.append(t("<input>",{type:"hidden",name:o,value:i[o]}))}t(document.body).append(a),a.submit()}function h(e){e&&e.readyState<4&&(e.onreadystatechange=t.noop,e.abort())}function m(){return(new Date).getTime()}function v(e){var n=new Array;for(i in e)n.push(e[i].clone()),n[i].find("script").each((function(){this.src||t._data(this,"globalEval",!1)})),n[i]=n[i].contents();return n}function x(t){return t.search=t.search.replace(/([?&])(_pjax|_)=[^&]*/g,"").replace(/^&/,""),t.href.replace(/\?($|#)/,"$1")}function y(t){var e=document.createElement("a");return e.href=t,e}function g(t){return t.href.replace(/#.*/,"")}function j(e,n){return e&&n?((n=t.extend({},n)).container=e,n):t.isPlainObject(e)?e:{container:e}}function w(t,e){return t.filter(e).add(t.find(e))}function b(e){return t.parseHTML(e,document,!0)}function T(e,n,r){var a,o,s={},c=/<html/i.test(e),u=n.getResponseHeader("X-PJAX-URL");if(s.url=u?x(y(u)):r.requestUrl,c){o=t(b(e.match(/<body[^>]*>([\s\S.]*)<\/body>/i)[0]));var l=e.match(/<head[^>]*>([\s\S.]*)<\/head>/i);a=null!=l?t(b(l[0])):o}else a=o=t(b(e));if(0===o.length)return s;if(s.title=w(a,"title").last().text(),s.contents=new Array,r.fragment){var p=new Array;for(i in r.fragment)p.push(o),s.contents.push(null),"body"!==p[i]&&(p[i]=w(p[i],r.fragment[i]).first()),p[i].length&&(s.contents[i]="body"===r.fragment[i]?p[i]:p[i].contents(),s.title||(s.title=p[i].attr("title")||p[i].data("title")))}else c||s.contents.push(o);if(null==s.contents[0])return s;if(s.contents)for(i in s.contents)null!=s.contents[i]&&(s.contents[i]=s.contents[i].not((function(){return t(this).is("title")})),s.contents[i].find("title").remove(),s.scripts=w(s.contents[i],"script[src]").remove(),s.contents[i]=s.contents[i].not(s.scripts[i]));return s.title&&(s.title=t.trim(s.title)),s}p&&p.container&&(o.state=p),"state"in window.history&&(u=!1);var E={},A=[],S=[];function C(t,e){for(;t.length>e;)delete E[t.shift()]}function P(){return t("meta").filter((function(){var e=t(this).attr("http-equiv");return e&&"X-PJAX-VERSION"===e.toUpperCase()})).attr("content")}function D(){t.fn.pjax=e,t.pjax=o,t.pjax.form=a,t.pjax.enable=t.noop,t.pjax.disable=G,t.pjax.click=n,t.pjax.submit=r,t.pjax.reload=s,t.pjax.defaults={timeout:650,push:!0,replace:!1,type:"GET",dataType:"html",scrollTo:0,maxCacheLength:20,version:P},t(window).on("popstate.pjax",f)}function G(){t.fn.pjax=function(){return this},t.pjax=d,t.pjax.enable=D,t.pjax.disable=t.noop,t.pjax.click=t.noop,t.pjax.submit=t.noop,t.pjax.reload=function(){window.location.reload()},t(window).off("popstate.pjax",f)}t.event.props&&t.inArray("state",t.event.props)<0?t.event.props.push("state"):"state"in t.Event.prototype||t.event.addProp("state"),t.support.pjax=window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]\D|WebApps\/.+CFNetwork)/),t.support.pjax?D():G()}(jQuery);