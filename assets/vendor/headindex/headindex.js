!function(t,e){var i=function(){function e(e,i){this.settings=t.extend(!0,t.fn.headIndex.default,i||{}),this.element=e,this.init()}return e.prototype={init:function(){if(this.articleWrap=t(this.settings.articleWrapSelector),this.headerList=this.articleWrap.find(":header"),this.indexBox=t(this.settings.indexBoxSelector),this.scrollBody=t(this.settings.scrollSelector),this.scrollWrap=t(this.settings.scrollWrap),this.manual=!1,0===this.indexBox.length||0===this.headerList.length)return null;this.initHeader(),this.event()},initHeader:function(){for(var t=0;t<this.headerList.length;t++,this.autoId++)this.headerList[t].id=this.headerList[t].id||"header-id-"+this.autoId,this.headerList[t].topHeight=this.offsetTop(this.headerList[t]),this.headerList[t].h=Number(this.headerList[t].tagName.charAt(1));this.tempHtml=[],this.buildHtml(this.buildTree());var e="<ul>"+this.tempHtml.join("")+"</ul>";this.indexBox.html(e)},event:function(){var e=this,i=null;this.indexBox.on("click.headindex",(function(s){var h=t(s.target);if(h.hasClass(e.settings.linkClass)){s.preventDefault();var n=h.parent("."+e.settings.itemClass);e.manual=!0,i&&(clearTimeout(i),i=null),i=setTimeout((function(){e.manual=!1}),300),e.current(n),e.scrollTo(s.target.getAttribute("href"))}})),t(this.scrollWrap).scroll((function(){e.manual||e.updateCurrent()})),e.updateCurrent()},updateTopHeight:function(){var t,e=this.headerList.length;if(0!==e&&(this.headerList[0].topHeight!==this.offsetTop(this.headerList[0])||this.headerList[e-1].topHeight!==this.offsetTop(this.headerList[e-1])))if(this.headerList[0].topHeight-this.offsetTop(this.headerList[0])!=this.headerList[e-1].topHeight-this.offsetTop(this.headerList[e-1]))for(t=0;t<this.headerList.length;t++,this.autoId++)this.headerList[t].topHeight=this.offsetTop(this.headerList[t]);else{var i=this.offsetTop(this.headerList[0])-this.headerList[0].topHeight;for(t=0;t<this.headerList.length;t++,this.autoId++)this.headerList[t].topHeight+=i}},current:function(t){var e,i="current";if(0!==t.length&&!t.hasClass(i)){var s=this.indexBox.find("li."+i);s.length>0&&s.removeClass(i),this.indexBox.find("ul.open").removeClass("open"),(e=t.children("."+this.settings.subItemBoxClass)).length>0&&e.addClass("open").slideDown();var h=t.parents("ul."+this.settings.subItemBoxClass);h.length>0&&h.addClass("open").slideDown(),(e=this.indexBox.find("ul."+this.settings.subItemBoxClass).not(".open")).length>0&&e.slideUp(),t.addClass(i)}},buildHtml:function(t){if(void 0!==t&&0!==t.length)for(var e=0;e<t.length;e++)this.tempHtml.push("<li class='"+this.settings.itemClass+"'><a no-pjax class='"+this.settings.linkClass+"' href='#"+t[e].item.id+"'>"+t[e].item.innerText+"</a>"),0!==t[e].children.length&&(this.tempHtml.push("<ul class='"+this.settings.subItemBoxClass+"'>"),this.buildHtml(t[e].children),this.tempHtml.push("</ul>")),this.tempHtml.push("</li>")},buildTree:function(){for(var t,e=null,i=[],s=0;s<this.headerList.length;s++)if(null!=e)if(e.item.h<this.headerList[s].h)t={item:this.headerList[s],parent:e,children:[]},e.children.push(t),e=t;else if(e.item.h!==this.headerList[s].h){for(;null!=e&&e.item.h>this.headerList[s].h;)e=e.parent;null!=e?s--:(e={item:this.headerList[s],parent:null,children:[]},i.push(e))}else t={item:this.headerList[s],parent:e.parent,children:[]},(e.parent&&e.parent.children||i).push(t),e=t;else e={item:this.headerList[s],parent:null,children:[]},i.push(e);return i},search:function(t,e,i){if(0===this.headerList.length)return null;if(e-t<=1)return this.headerList[e].topHeight<i?this.headerList[e]:this.headerList[t];if(t<e){var s=parseInt((t+e)/2),h=this.headerList[s].topHeight;if(i<h)e=s;else{if(!(i>h))return this.headerList[s];t=s}return this.search(t,e,i)}},offsetTop:function(e){return t(e).offset().top-this.settings.offset},scrollTo:function(t){this.scrollBody.stop().animate({scrollTop:this.offsetTop(document.getElementById(t.substr(1)))},"fast")},updateCurrent:function(){var t=this.scrollBody.scrollTop();this.updateTopHeight();var e=this.search(0,this.headerList.length-1,t);if(e){var i=this.indexBox.find('a[href="#'+e.id+'"]').parent("li."+this.settings.itemClass);this.current(i)}},clean:function(){this.element&&this.element.data("headIndex",null)},ignoreScrollEvent:function(t){t?this.manual=!0:(this.manual=!1,this.updateCurrent())}},e.prototype.autoId=1,e}();t.fn.headIndex=function(e){return this.each((function(){var s=t(this),h=s.data("headIndex");if(h=new i(s,e),s.data("headIndex",h),"string"===t.type(e))return h[e]()}))},t.fn.headIndex.default={articleWrapSelector:".article-wrap",indexBoxSelector:".index-box",scrollSelector:"body,html",scrollWrap:e,subItemBoxClass:"index-subItem-box",itemClass:"index-item",linkClass:"index-link",offset:0}}(jQuery,window);